"use strict";(self.webpackChunkdanatelecom=self.webpackChunkdanatelecom||[]).push([[531],{5531:function(e,t,r){r.r(t);var n=r(5861),a=r(885),s=r(7757),l=r.n(s),o=r(2791),i=r(6871),c=r(3504),d=r(4390),u=r(3071),m=r(184),x="https://dana-telecom-backend-production.up.railway.app/";t.default=function(){var e=(0,i.UO)().id,t=(0,i.s0)(),r=(0,o.useState)([]),s=(0,a.Z)(r,2),v=s[0],g=s[1],p=(0,o.useState)(null),h=(0,a.Z)(p,2),f=h[0],b=h[1],j=(0,o.useState)(!0),N=(0,a.Z)(j,2),k=N[0],y=N[1],w=(0,o.useState)(null),S=(0,a.Z)(w,2),_=S[0],I=S[1],T=(0,o.useState)(""),C=(0,a.Z)(T,2),Z=C[0],D=C[1],E=(0,o.useState)(null),A=(0,a.Z)(E,2),F=A[0],U=A[1],L=(0,o.useState)(""),P=(0,a.Z)(L,2),R=P[0],X=P[1],z=(0,o.useState)(null),B=(0,a.Z)(z,2),G=B[0],Y=B[1],H=(0,o.useState)(""),W=(0,a.Z)(H,2),$=W[0],q=W[1];(0,o.useEffect)((function(){var t=function(){var e=(0,n.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(localStorage.getItem("userToken")||localStorage.getItem("adminToken"))){e.next=7;break}return e.next=5,(0,d.ts)();case 5:t=e.sent,U(t);case 7:e.next=14;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error fetching user:",e.t0),localStorage.removeItem("userToken"),localStorage.removeItem("adminToken");case 14:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),r=function(){var r=(0,n.Z)(l().mark((function r(){var n,a,s,o;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,y(!0),r.next=4,t();case 4:if(!e){r.next=14;break}return r.next=7,(0,d.XC)(e);case 7:if(n=r.sent){r.next=11;break}return I("News post not found"),r.abrupt("return");case 11:b(n),r.next=18;break;case 14:return r.next=16,(0,d.dD)();case 16:a=r.sent,g(a);case 18:I(null),r.next=25;break;case 21:r.prev=21,r.t0=r.catch(0),console.error("Error fetching data:",r.t0),I((null===(s=r.t0.response)||void 0===s||null===(o=s.data)||void 0===o?void 0:o.message)||"Failed to fetch data");case 25:return r.prev=25,y(!1),r.finish(25);case 28:case"end":return r.stop()}}),r,null,[[0,21,25,28]])})));return function(){return r.apply(this,arguments)}}();r()}),[e]);var M,O,J,K,Q,V,ee,te=function(){var r=(0,n.Z)(l().mark((function r(n){var a,s;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(localStorage.getItem("userToken")||localStorage.getItem("adminToken")){r.next=4;break}return t("/login"),r.abrupt("return");case 4:return r.prev=4,r.next=7,(0,d.eX)(n);case 7:a=r.sent,e?b(a):g((function(e){return e.map((function(e){return e._id===n?a:e}))})),r.next=15;break;case 11:r.prev=11,r.t0=r.catch(4),console.error("Error liking news:",r.t0),401===(null===(s=r.t0.response)||void 0===s?void 0:s.status)&&(localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),t("/login"));case 15:case"end":return r.stop()}}),r,null,[[4,11]])})));return function(e){return r.apply(this,arguments)}}(),re=function(){var r=(0,n.Z)(l().mark((function r(n){var a,s;return l().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(localStorage.getItem("userToken")||localStorage.getItem("adminToken")){r.next=4;break}return t("/login"),r.abrupt("return");case 4:if(Z.trim()){r.next=7;break}return X("Please enter a comment"),r.abrupt("return");case 7:return r.prev=7,X(""),r.next=11,(0,d.Ir)(n,Z);case 11:a=r.sent,e?b(a):g((function(e){return e.map((function(e){return e._id===n?a:e}))})),D(""),r.next=21;break;case 16:r.prev=16,r.t0=r.catch(7),console.error("Error adding comment:",r.t0),X("Failed to add comment. Please try again."),401===(null===(s=r.t0.response)||void 0===s?void 0:s.status)&&(localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),t("/login"));case 21:case"end":return r.stop()}}),r,null,[[7,16]])})));return function(e){return r.apply(this,arguments)}}(),ne=function(){var e=(0,n.Z)(l().mark((function e(r){var n,a,s,o;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("adminToken")||localStorage.getItem("userToken")){e.next=4;break}return t("/login"),e.abrupt("return");case 4:if(a=f.comments.find((function(e){return e._id===r}))){e.next=7;break}return e.abrupt("return");case 7:if("admin"===(null===F||void 0===F?void 0:F.role)||(null===F||void 0===F?void 0:F._id)===(null===(n=a.user)||void 0===n?void 0:n._id)){e.next=10;break}return I("You are not authorized to delete this comment"),e.abrupt("return");case 10:return e.prev=10,e.next=13,(0,d.YF)(f._id,r);case 13:s=e.sent,b(s),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(10),console.error("Error deleting comment:",e.t0),I("Failed to delete comment"),401===(null===(o=e.t0.response)||void 0===o?void 0:o.status)&&(localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),t("/login"));case 22:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=(0,n.Z)(l().mark((function e(r){var n,a;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(localStorage.getItem("adminToken")||localStorage.getItem("userToken")){e.next=4;break}return t("/login"),e.abrupt("return");case 4:if($.trim()){e.next=7;break}return X("Please enter a reply"),e.abrupt("return");case 7:return e.prev=7,X(""),e.next=11,(0,d.Bn)(f._id,r,$);case 11:n=e.sent,b(n),q(""),Y(null),e.next=22;break;case 17:e.prev=17,e.t0=e.catch(7),console.error("Error adding reply:",e.t0),X("Failed to add reply. Please try again."),401===(null===(a=e.t0.response)||void 0===a?void 0:a.status)&&(localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),t("/login"));case 22:case"end":return e.stop()}}),e,null,[[7,17]])})));return function(t){return e.apply(this,arguments)}}(),se=function(){var e=(0,n.Z)(l().mark((function e(r,n){var a,s,o,i,c,u,m,x,v,g,p;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Attempting to delete reply:",{commentId:r,replyId:n}),localStorage.getItem("adminToken")||localStorage.getItem("userToken")){e.next=6;break}return console.log("No token found, redirecting to login"),t("/login"),e.abrupt("return");case 6:if(s=f.comments.find((function(e){return e._id===r}))){e.next=11;break}return console.log("Comment not found:",r),I("Comment not found"),e.abrupt("return");case 11:if(o=s.replies.find((function(e){return e._id===n}))){e.next=16;break}return console.log("Reply not found:",n),I("Reply not found"),e.abrupt("return");case 16:if("admin"===(null===F||void 0===F?void 0:F.role)||(null===F||void 0===F?void 0:F._id)===(null===(a=o.user)||void 0===a?void 0:a._id)){e.next=20;break}return console.log("User not authorized to delete reply:",{userRole:null===F||void 0===F?void 0:F.role,userId:null===F||void 0===F?void 0:F._id,replyUserId:null===(i=o.user)||void 0===i?void 0:i._id}),I("You are not authorized to delete this reply"),e.abrupt("return");case 20:return e.prev=20,console.log("Sending delete request for reply:",{newsId:f._id,commentId:r,replyId:n}),e.next=24,(0,d.Mf)(f._id,r,n);case 24:c=e.sent,console.log("Reply deleted successfully, updating news:",c),b(c),I(null),e.next=37;break;case 30:e.prev=30,e.t0=e.catch(20),console.error("Error deleting reply:",e.t0),p=(null===(u=e.t0.response)||void 0===u||null===(m=u.data)||void 0===m?void 0:m.error)||e.t0.message||"Failed to delete reply",console.log("Error details:",{status:null===(x=e.t0.response)||void 0===x?void 0:x.status,data:null===(v=e.t0.response)||void 0===v?void 0:v.data,message:p}),I(p),401===(null===(g=e.t0.response)||void 0===g?void 0:g.status)&&(console.log("Authentication error, clearing tokens and redirecting to login"),localStorage.removeItem("userToken"),localStorage.removeItem("adminToken"),t("/login"));case 37:case"end":return e.stop()}}),e,null,[[20,30]])})));return function(t,r){return e.apply(this,arguments)}}();return k?(0,m.jsx)("div",{className:"bg-gray-900 min-h-screen py-12 pt-24",dir:"rtl",children:(0,m.jsx)("div",{className:"container mx-auto px-4",children:(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),(0,m.jsx)("p",{className:"mt-4 text-lg text-gray-300",children:"\u062c\u0627\u0631\u064a \u0627\u0644\u062a\u062d\u0645\u064a\u0644..."})]})})}):_?(0,m.jsx)("div",{className:"bg-gray-900 min-h-screen py-12 pt-24",dir:"rtl",children:(0,m.jsx)("div",{className:"container mx-auto px-4",children:(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("p",{className:"text-red-400",children:_}),(0,m.jsx)("button",{onClick:function(){return t("/news")},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"\u0627\u0644\u0639\u0648\u062f\u0629 \u0625\u0644\u0649 \u0627\u0644\u0623\u062e\u0628\u0627\u0631"})]})})}):e&&!f?(0,m.jsx)("div",{className:"bg-gray-900 min-h-screen py-12 pt-24",dir:"rtl",children:(0,m.jsx)("div",{className:"container mx-auto px-4",children:(0,m.jsxs)("div",{className:"text-center",children:[(0,m.jsx)("p",{className:"text-red-400",children:"\u0644\u0645 \u064a\u062a\u0645 \u0627\u0644\u0639\u062b\u0648\u0631 \u0639\u0644\u0649 \u0627\u0644\u062e\u0628\u0631"}),(0,m.jsx)("button",{onClick:function(){return t("/news")},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"\u0627\u0644\u0639\u0648\u062f\u0629 \u0625\u0644\u0649 \u0627\u0644\u0623\u062e\u0628\u0627\u0631"})]})})}):e?(0,m.jsx)("div",{className:"bg-gray-900 min-h-screen py-12 pt-24",dir:"rtl",children:(0,m.jsx)("div",{className:"container mx-auto px-4",children:(0,m.jsxs)("div",{className:"max-w-4xl mx-auto bg-gray-800 rounded-lg overflow-hidden",children:[f.image&&(0,m.jsx)("img",{src:"".concat(x).concat(f.image),alt:f.title,className:"w-full h-96 object-cover",onError:function(e){e.target.onerror=null,e.target.src="/placeholder-image.jpg"}}),(0,m.jsxs)("div",{className:"p-8",children:[(0,m.jsx)("h1",{className:"text-3xl font-bold text-blue-400 mb-4",children:f.title}),(0,m.jsx)("p",{className:"text-gray-300 mb-4",children:f.content}),(0,m.jsxs)("div",{className:"flex items-center justify-between text-gray-400 text-sm mb-8",children:[(0,m.jsxs)("span",{children:["\u0628\u0648\u0627\u0633\u0637\u0629 ",null===(M=f.author)||void 0===M?void 0:M.firstName," ",(null===(O=f.author)||void 0===O?void 0:O.lastName)||"\u0645\u0633\u062a\u062e\u062f\u0645"]}),(0,m.jsx)("span",{children:new Date(f.createdAt).toLocaleDateString("ar-SA",{calendar:"gregory"})})]}),(0,m.jsxs)("div",{className:"border-t border-gray-700 pt-4",children:[(0,m.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,m.jsxs)("button",{onClick:function(){return te(f._id)},className:"flex items-center gap-2 ".concat(null!==(J=f.likes)&&void 0!==J&&J.includes(null===F||void 0===F?void 0:F._id)?"text-red-500":"text-gray-400"),children:[null!==(K=f.likes)&&void 0!==K&&K.includes(null===F||void 0===F?void 0:F._id)?(0,m.jsx)(u.$0H,{className:"text-xl"}):(0,m.jsx)(u.BgW,{className:"text-xl"}),(0,m.jsx)("span",{children:(null===(Q=f.likes)||void 0===Q?void 0:Q.length)||0})]}),(0,m.jsx)("button",{onClick:function(){return function(e){var t="".concat(window.location.origin,"/news/").concat(e);navigator.clipboard.writeText(t)}(f._id)},className:"text-gray-400 hover:text-blue-400",children:(0,m.jsx)(u.Lrt,{className:"text-xl"})})]}),(0,m.jsxs)("div",{className:"mt-8",children:[(0,m.jsxs)("h3",{className:"text-xl font-bold text-blue-400 mb-4 flex items-center gap-2",children:[(0,m.jsx)(u.DCG,{className:"text-xl"}),"\u0627\u0644\u062a\u0639\u0644\u064a\u0642\u0627\u062a (",(null===(V=f.comments)||void 0===V?void 0:V.length)||0,")"]}),F&&(0,m.jsxs)("div",{className:"mb-4",children:[(0,m.jsx)("textarea",{value:Z,onChange:function(e){D(e.target.value),X("")},placeholder:"\u0627\u0643\u062a\u0628 \u062a\u0639\u0644\u064a\u0642\u0643 \u0647\u0646\u0627...",className:"w-full p-2 rounded bg-gray-700 text-white border border-gray-600 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",rows:"3"}),R&&(0,m.jsx)("p",{className:"text-red-400 text-sm mt-1",children:R}),(0,m.jsx)("button",{onClick:function(){return re(f._id)},className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"\u062a\u0639\u0644\u064a\u0642"})]}),(0,m.jsx)("div",{className:"space-y-4",children:null===(ee=f.comments)||void 0===ee?void 0:ee.map((function(e){var t,r,n;return(0,m.jsxs)("div",{className:"bg-gray-700 p-4 rounded",children:[(0,m.jsx)("div",{className:"flex justify-between items-start",children:(0,m.jsxs)("div",{children:[(0,m.jsxs)("p",{className:"font-bold text-blue-400",children:[null===(t=e.user)||void 0===t?void 0:t.firstName," ",(null===(r=e.user)||void 0===r?void 0:r.lastName)||"\u0645\u0633\u062a\u062e\u062f\u0645"]}),(0,m.jsx)("p",{className:"text-gray-300 mt-1",children:e.content}),(0,m.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[F&&(0,m.jsxs)("button",{onClick:function(){return Y(e._id)},className:"text-blue-400 hover:text-blue-300 text-sm flex items-center gap-1",children:[(0,m.jsx)(u.DCG,{className:"text-sm"}),"\u0631\u062f"]}),("admin"===(null===F||void 0===F?void 0:F.role)||(null===F||void 0===F?void 0:F._id)===(null===(n=e.user)||void 0===n?void 0:n._id))&&(0,m.jsxs)("button",{onClick:function(){return ne(e._id)},className:"text-red-400 hover:text-red-300 text-sm flex items-center gap-1",children:[(0,m.jsx)(u.Xm5,{className:"text-sm"}),"\u062d\u0630\u0641"]})]})]})}),(0,m.jsx)("p",{className:"text-gray-400 text-sm mt-2",children:new Date(e.createdAt).toLocaleDateString("ar-SA",{calendar:"gregory"})}),e.replies&&e.replies.length>0&&(0,m.jsx)("div",{className:"mt-3 mr-4 space-y-2",children:e.replies.map((function(t){var r,n,a;return(0,m.jsxs)("div",{className:"bg-gray-600 p-3 rounded",children:[(0,m.jsxs)("div",{className:"flex justify-between items-start",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("p",{className:"font-semibold text-blue-400",children:[null===(r=t.user)||void 0===r?void 0:r.firstName," ",null===(n=t.user)||void 0===n?void 0:n.lastName]}),(0,m.jsx)("p",{className:"text-gray-300 text-sm mt-1",children:t.content})]}),("admin"===(null===F||void 0===F?void 0:F.role)||(null===F||void 0===F?void 0:F._id)===(null===(a=t.user)||void 0===a?void 0:a._id))&&(0,m.jsx)("button",{onClick:function(){return se(e._id,t._id)},className:"text-red-400 hover:text-red-300 text-sm",children:(0,m.jsx)(u.Xm5,{})})]}),(0,m.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:new Date(t.createdAt).toLocaleDateString("ar-SA",{calendar:"gregory"})})]},t._id)}))}),G===e._id&&(0,m.jsxs)("div",{className:"mt-3 mr-4",children:[(0,m.jsx)("textarea",{value:$,onChange:function(e){return q(e.target.value)},placeholder:"\u0627\u0643\u062a\u0628 \u0631\u062f\u0643 \u0647\u0646\u0627...",className:"w-full p-2 rounded bg-gray-600 text-white border border-gray-500 focus:border-blue-500 focus:ring-1 focus:ring-blue-500",rows:"2"}),(0,m.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,m.jsx)("button",{onClick:function(){return ae(e._id)},className:"px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:"\u0625\u0631\u0633\u0627\u0644"}),(0,m.jsx)("button",{onClick:function(){Y(null),q("")},className:"px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-700 text-sm",children:"\u0625\u0644\u063a\u0627\u0621"})]})]})]},e._id)}))})]})]})]})]})})}):(0,m.jsx)("div",{className:"bg-gray-900 min-h-screen py-12 pt-24",dir:"rtl",children:(0,m.jsxs)("div",{className:"container mx-auto px-4",children:[(0,m.jsx)("h1",{className:"text-4xl font-bold text-blue-400 mb-8",children:"\u0622\u062e\u0631 \u0627\u0644\u0623\u062e\u0628\u0627\u0631"}),(0,m.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:v.map((function(e){var t,r;return(0,m.jsxs)("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:[(0,m.jsx)(c.rU,{to:"/news/".concat(e._id),children:e.image&&(0,m.jsx)("img",{src:"".concat(x).concat(e.image),alt:e.title,className:"w-full h-48 object-cover",onError:function(e){e.target.onerror=null,e.target.src="/placeholder-image.jpg"}})}),(0,m.jsxs)("div",{className:"p-6",children:[(0,m.jsx)(c.rU,{to:"/news/".concat(e._id),children:(0,m.jsx)("h2",{className:"text-xl font-bold text-blue-400 mb-2",children:e.title})}),(0,m.jsx)("p",{className:"text-gray-300 mb-4 line-clamp-3",children:e.content}),(0,m.jsxs)("div",{className:"flex items-center justify-between text-gray-400 text-sm",children:[(0,m.jsxs)("span",{children:["\u0628\u0648\u0627\u0633\u0637\u0629 ",null===(t=e.author)||void 0===t?void 0:t.firstName," ",(null===(r=e.author)||void 0===r?void 0:r.lastName)||"\u0645\u0633\u062a\u062e\u062f\u0645"]}),(0,m.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString("ar-SA")})]}),(0,m.jsxs)("div",{className:"flex items-center gap-4 mt-4",children:[(0,m.jsxs)("button",{onClick:function(){return te(e._id)},className:"flex items-center gap-2 ".concat(e.likes.includes(null===F||void 0===F?void 0:F._id)?"text-red-500":"text-gray-400"),children:[e.likes.includes(null===F||void 0===F?void 0:F._id)?(0,m.jsx)(u.$0H,{className:"text-xl"}):(0,m.jsx)(u.BgW,{className:"text-xl"}),(0,m.jsx)("span",{children:e.likes.length})]}),(0,m.jsxs)(c.rU,{to:"/news/".concat(e._id),className:"flex items-center gap-2 text-gray-400",children:[(0,m.jsx)(u.DCG,{className:"text-xl"}),(0,m.jsx)("span",{children:e.comments.length})]})]})]})]},e._id)}))})]})})}}}]);
//# sourceMappingURL=531.cccd062a.chunk.js.map